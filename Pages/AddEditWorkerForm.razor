@page "/workers/add-edit"
@code {
    // Data model for the form
    public class WorkerModel
    {
        public string Status { get; set; }
        public string WorkerId { get; set; }
        [Required]
        public string LastName { get; set; }
        [Required]
        public string FirstName { get; set; }
        public string MiddleInitial { get; set; }
        public string NickName { get; set; }
        public DateTime? BirthDate { get; set; }
        public string Gender { get; set; }
        public string Race { get; set; }
        public string MaritalStatus { get; set; }
        public string NPI { get; set; }
        public string Street { get; set; }
        public string City { get; set; }
        public string State { get; set; }
        public string ZipCode { get; set; }
        public string HomePhone { get; set; }
        public string WorkPhone { get; set; }
        public string CellPhone { get; set; }
        public string Pager { get; set; }
        public string EmailAddress { get; set; }
        public string PublicUserName { get; set; }
        public string FederatedUserPrincipleName { get; set; }
        public string HomeBranch { get; set; }
        public string Department { get; set; }
        public string JobTitle { get; set; }
        public string WorkerGroup { get; set; }
        public string SignatureTitle { get; set; }
        public string ECFullName { get; set; }
        public string ECRelation { get; set; }
        public string ECHomePhone { get; set; }
        public string ECWorkPhone { get; set; }
        public string ECCellPhone { get; set; }
        public string ECEmail { get; set; }
        public string UserField1 { get; set; }
        public string UserField2 { get; set; }
        public string Comments { get; set; }
        public string ReferredBy { get; set; }
        public string ReferralCategory { get; set; }
        public string ReferralContactPhone { get; set; }
    }

    private WorkerModel workerModel = new WorkerModel();

    // Event handler stubs
    private void HandleValidSubmit()
    {
        // TODO: Implement save logic
    }
    private void AddServiceLine() { }
    private void SetDefaultServiceLine() { }
    private void InactivateServiceLine() { }
    private void AddLocation() { }
    private void InactivateLocation() { }
    private void AddQualification() { }
    private void EditQualification() { }
    private void DeleteQualification() { }
    private void AddOrientedClient() { }
    private void AddIncompatibleClient() { }
}
@using System.ComponentModel.DataAnnotations
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components.Forms

<h2>Add/Edit Worker</h2>

<!-- Bootstrap and custom styles are assumed to be included globally -->
<style>
    .required-field::after {
        content: " *";
        color: red;
    }
    .form-section {
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        padding: 1rem;
        margin-bottom: 1rem;
        background-color: #f8f9fa;
        color: #495057;
        border-bottom: 1px solid #dee2e6;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
    }
    .nav-tabs .nav-link.active {
        background-color: #0d6efd;
        color: white;
        border-color: #0d6efd;
    }
</style>

<EditForm Model="@workerModel" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div class="container-fluid mt-3">
        <ul class="nav nav-tabs" id="workerTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="demographics-tab" data-bs-toggle="tab" data-bs-target="#demographics" type="button" role="tab" aria-controls="demographics" aria-selected="true">Demographics</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="organization-tab" data-bs-toggle="tab" data-bs-target="#organization" type="button" role="tab" aria-controls="organization" aria-selected="false">Organization Assignments</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="qualifications-tab" data-bs-toggle="tab" data-bs-target="#qualifications" type="button" role="tab" aria-controls="qualifications" aria-selected="false">Qualifications</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="availability-tab" data-bs-toggle="tab" data-bs-target="#availability" type="button" role="tab" aria-controls="availability" aria-selected="false">Availability</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="clients-tab" data-bs-toggle="tab" data-bs-target="#clients" type="button" role="tab" aria-controls="clients" aria-selected="false">Clients</button>
            </li>
        </ul>
        <div class="tab-content" id="workerTabContent">
            <!-- Demographics Tab -->
            <div class="tab-pane fade show active" id="demographics" role="tabpanel" aria-labelledby="demographics-tab">
                <div class="row mt-3">
                    <!-- Personal Information Section -->
                    <div class="col-md-6">
                        <div class="form-section">
                            <h5>Personal Information</h5>
                            <!-- ...existing personal info fields... -->
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="status" class="form-label">Status:</label>
                                    <InputSelect id="status" class="form-select" @bind-Value="workerModel.Status">
                                        <option value="">Select Status</option>
                                        <option value="Active">Active</option>
                                        <option value="Inactive">Inactive</option>
                                        <option value="Pending">Pending</option>
                                    </InputSelect>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="workerId" class="form-label">Worker ID:</label>
                                    <InputText id="workerId" class="form-control" @bind-Value="workerModel.WorkerId" readonly />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="lastName" class="form-label required-field">Last Name</label>
                                    <InputText id="lastName" class="form-control" @bind-Value="workerModel.LastName" maxlength="50" />
                                    <ValidationMessage For="@(() => workerModel.LastName)" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="firstName" class="form-label required-field">First Name</label>
                                    <InputText id="firstName" class="form-control" @bind-Value="workerModel.FirstName" maxlength="50" />
                                    <ValidationMessage For="@(() => workerModel.FirstName)" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="middleInitial" class="form-label">Middle Initial:</label>
                                    <InputText id="middleInitial" class="form-control" @bind-Value="workerModel.MiddleInitial" maxlength="1" />
                                </div>
                                <div class="col-md-9 mb-3">
                                    <label for="nickName" class="form-label">Nick Name:</label>
                                    <InputText id="nickName" class="form-control" @bind-Value="workerModel.NickName" maxlength="30" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="birthDate" class="form-label">Birth Date:</label>
                                    <InputDate id="birthDate" class="form-control" @bind-Value="workerModel.BirthDate" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="gender" class="form-label">Gender:</label>
                                    <InputSelect id="gender" class="form-select" @bind-Value="workerModel.Gender">
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </InputSelect>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="race" class="form-label">Race:</label>
                                    <InputSelect id="race" class="form-select" @bind-Value="workerModel.Race">
                                        <option value="">Select Race</option>
                                        <option value="White">White</option>
                                        <option value="Black or African American">Black or African American</option>
                                        <option value="American Indian or Alaska Native">American Indian or Alaska Native</option>
                                        <option value="Asian">Asian</option>
                                        <option value="Native Hawaiian or Other Pacific Islander">Native Hawaiian or Other Pacific Islander</option>
                                        <option value="Hispanic or Latino">Hispanic or Latino</option>
                                        <option value="Other">Other</option>
                                    </InputSelect>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="maritalStatus" class="form-label">Marital Status:</label>
                                    <InputSelect id="maritalStatus" class="form-select" @bind-Value="workerModel.MaritalStatus">
                                        <option value="">Select Status</option>
                                        <option value="Single">Single</option>
                                        <option value="Married">Married</option>
                                        <option value="Divorced">Divorced</option>
                                        <option value="Widowed">Widowed</option>
                                        <option value="Separated">Separated</option>
                                    </InputSelect>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="npi" class="form-label">NPI:</label>
                                <InputText id="npi" class="form-control" @bind-Value="workerModel.NPI" maxlength="10" />
                                <div class="form-text">National Provider Identifier (10 digits)</div>
                            </div>
                        </div>
                    </div>
                    <!-- Contact Information Section -->
                    <div class="col-md-6">
                        <div class="form-section">
                            <h5>Contact Information</h5>
                            <div class="mb-3">
                                <label for="street" class="form-label">Street Address:</label>
                                <InputText id="street" class="form-control" @bind-Value="workerModel.Street" maxlength="100" />
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="city" class="form-label">City:</label>
                                    <InputText id="city" class="form-control" @bind-Value="workerModel.City" maxlength="50" />
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="state" class="form-label">State:</label>
                                    <InputText id="state" class="form-control" @bind-Value="workerModel.State" maxlength="2" />
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="zipCode" class="form-label">Zip Code:</label>
                                    <InputText id="zipCode" class="form-control" @bind-Value="workerModel.ZipCode" maxlength="10" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="homePhone" class="form-label">Home Phone:</label>
                                    <InputText id="homePhone" class="form-control" @bind-Value="workerModel.HomePhone" maxlength="15" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="workPhone" class="form-label">Work Phone:</label>
                                    <InputText id="workPhone" class="form-control" @bind-Value="workerModel.WorkPhone" maxlength="15" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="cellPhone" class="form-label">Cell Phone:</label>
                                    <InputText id="cellPhone" class="form-control" @bind-Value="workerModel.CellPhone" maxlength="15" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="pager" class="form-label">Pager:</label>
                                    <InputText id="pager" class="form-control" @bind-Value="workerModel.Pager" maxlength="15" />
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="emailAddress" class="form-label">Email Address:</label>
                                <InputText id="emailAddress" class="form-control" @bind-Value="workerModel.EmailAddress" maxlength="100" />
                            </div>
                            <div class="mb-3">
                                <label for="publicUserName" class="form-label">Public User Name:</label>
                                <InputText id="publicUserName" class="form-control" @bind-Value="workerModel.PublicUserName" maxlength="50" />
                            </div>
                            <div class="mb-3">
                                <label for="federatedUserPrincipleName" class="form-label">Federated User Principal Name:</label>
                                <InputText id="federatedUserPrincipleName" class="form-control" @bind-Value="workerModel.FederatedUserPrincipleName" maxlength="100" />
                                <div class="form-text">Used for Active Directory integration</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <!-- Organization Information Section -->
                    <div class="col-md-6">
                        <div class="form-section">
                            <h5>Organization Information</h5>
                            <div class="mb-3">
                                <label for="homeBranch" class="form-label">Home Branch:</label>
                                <InputText id="homeBranch" class="form-control" @bind-Value="workerModel.HomeBranch" maxlength="100" />
                            </div>
                            <div class="mb-3">
                                <label for="department" class="form-label">Department:</label>
                                <InputText id="department" class="form-control" @bind-Value="workerModel.Department" maxlength="100" />
                            </div>
                            <div class="mb-3">
                                <label for="jobTitle" class="form-label">Job Title:</label>
                                <InputText id="jobTitle" class="form-control" @bind-Value="workerModel.JobTitle" maxlength="100" />
                            </div>
                            <div class="mb-3">
                                <label for="workerGroup" class="form-label">Worker Group:</label>
                                <InputText id="workerGroup" class="form-control" @bind-Value="workerModel.WorkerGroup" maxlength="100" />
                            </div>
                            <div class="mb-3">
                                <label for="signatureTitle" class="form-label">Signature Title:</label>
                                <InputText id="signatureTitle" class="form-control" @bind-Value="workerModel.SignatureTitle" maxlength="100" />
                            </div>
                        </div>
                    </div>
                    <!-- Emergency Contact Section -->
                    <div class="col-md-6">
                        <div class="form-section">
                            <h5>Emergency Contact</h5>
                            <div class="mb-3">
                                <label for="ecFullName" class="form-label">Full Name:</label>
                                <InputText id="ecFullName" class="form-control" @bind-Value="workerModel.ECFullName" maxlength="100" />
                            </div>
                            <div class="mb-3">
                                <label for="ecRelation" class="form-label">Relationship:</label>
                                <InputSelect id="ecRelation" class="form-select" @bind-Value="workerModel.ECRelation">
                                    <option value="">Select Relationship</option>
                                    <option value="Spouse">Spouse</option>
                                    <option value="Parent">Parent</option>
                                    <option value="Child">Child</option>
                                    <option value="Sibling">Sibling</option>
                                    <option value="Friend">Friend</option>
                                    <option value="Other Relative">Other Relative</option>
                                    <option value="Other">Other</option>
                                </InputSelect>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="ecHomePhone" class="form-label">Home Phone:</label>
                                    <InputText id="ecHomePhone" class="form-control" @bind-Value="workerModel.ECHomePhone" maxlength="15" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="ecWorkPhone" class="form-label">Work Phone:</label>
                                    <InputText id="ecWorkPhone" class="form-control" @bind-Value="workerModel.ECWorkPhone" maxlength="15" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="ecCellPhone" class="form-label">Cell Phone:</label>
                                    <InputText id="ecCellPhone" class="form-control" @bind-Value="workerModel.ECCellPhone" maxlength="15" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="ecEmail" class="form-label">Email:</label>
                                    <InputText id="ecEmail" class="form-control" @bind-Value="workerModel.ECEmail" maxlength="100" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <!-- Additional Information Section -->
                    <div class="col-md-12">
                        <div class="form-section">
                            <h5>Additional Information</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="userField1" class="form-label">User Field 1:</label>
                                    <InputText id="userField1" class="form-control" @bind-Value="workerModel.UserField1" maxlength="100" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="userField2" class="form-label">User Field 2:</label>
                                    <InputText id="userField2" class="form-control" @bind-Value="workerModel.UserField2" maxlength="100" />
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="comments" class="form-label">Comments:</label>
                                <InputTextArea id="comments" class="form-control" @bind-Value="workerModel.Comments" rows="4" maxlength="500" />
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="referredBy" class="form-label">Referred By:</label>
                                    <InputText id="referredBy" class="form-control" @bind-Value="workerModel.ReferredBy" maxlength="100" />
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="referralCategory" class="form-label">Referral Category:</label>
                                    <InputText id="referralCategory" class="form-control" @bind-Value="workerModel.ReferralCategory" maxlength="100" />
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="referralContactPhone" class="form-label">Referral Contact Phone:</label>
                                    <InputText id="referralContactPhone" class="form-control" @bind-Value="workerModel.ReferralContactPhone" maxlength="15" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Other tabs will be added next -->
            <!-- Organization Assignments Tab -->
            <div class="tab-pane fade" id="organization" role="tabpanel" aria-labelledby="organization-tab">
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="form-section">
                            <h5>Service Lines</h5>
                            <div class="mb-3">
                                <button type="button" class="btn btn-primary btn-sm me-2" @onclick="AddServiceLine">Add Service Line</button>
                                <button type="button" class="btn btn-warning btn-sm me-2" @onclick="SetDefaultServiceLine">Set as Default</button>
                                <button type="button" class="btn btn-danger btn-sm" @onclick="InactivateServiceLine">Inactivate</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-sm">
                                    <thead>
                                        <tr>
                                            <th>Service Line</th>
                                            <th>Status</th>
                                            <th>Default</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="3" class="text-muted">No service lines assigned</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-section">
                            <h5>Branches/Locations</h5>
                            <div class="mb-3">
                                <button type="button" class="btn btn-primary btn-sm me-2" @onclick="AddLocation">Add Location</button>
                                <button type="button" class="btn btn-danger btn-sm" @onclick="InactivateLocation">Inactivate</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-sm">
                                    <thead>
                                        <tr>
                                            <th>Location</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="2" class="text-muted">No locations assigned</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Qualifications Tab -->
            <div class="tab-pane fade" id="qualifications" role="tabpanel" aria-labelledby="qualifications-tab">
                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="form-section">
                            <h5>Worker Qualifications</h5>
                            <div class="mb-3">
                                <button type="button" class="btn btn-primary btn-sm me-2" @onclick="AddQualification">Add Qualification</button>
                                <button type="button" class="btn btn-warning btn-sm me-2" @onclick="EditQualification">Edit</button>
                                <button type="button" class="btn btn-danger btn-sm" @onclick="DeleteQualification">Delete</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-sm">
                                    <thead>
                                        <tr>
                                            <th>Qualification Type</th>
                                            <th>Date Obtained</th>
                                            <th>Expiration Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="4" class="text-muted">No qualifications added</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Availability Tab -->
            <div class="tab-pane fade" id="availability" role="tabpanel" aria-labelledby="availability-tab">
                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="form-section">
                            <h5>Worker Availability</h5>
                            <p class="text-muted">Configure when this worker is available for assignments.</p>
                            <div class="alert alert-info">
                                Availability configuration functionality would be implemented here.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Clients Tab -->
            <div class="tab-pane fade" id="clients" role="tabpanel" aria-labelledby="clients-tab">
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="form-section">
                            <h5>Oriented Clients</h5>
                            <div class="mb-3">
                                <button type="button" class="btn btn-primary btn-sm me-2" @onclick="AddOrientedClient">Add Oriented Client</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-sm">
                                    <thead>
                                        <tr>
                                            <th>Client Name</th>
                                            <th>Date Oriented</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="2" class="text-muted">No oriented clients</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-section">
                            <h5>Incompatible Clients</h5>
                            <div class="mb-3">
                                <button type="button" class="btn btn-primary btn-sm me-2" @onclick="AddIncompatibleClient">Add Incompatible Client</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-sm">
                                    <thead>
                                        <tr>
                                            <th>Client Name</th>
                                            <th>Reason</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="2" class="text-muted">No incompatible clients</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Form validation and handling
        document.getElementById('workerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (this.checkValidity()) {
                handleFormSubmit();
            } else {
                e.stopPropagation();
            }
            
            this.classList.add('was-validated');
        });

        function handleFormSubmit() {
            const formData = new FormData(document.getElementById('workerForm'));
            const workerData = Object.fromEntries(formData.entries());
            
            console.log('Worker data to save:', workerData);
            
            // Here you would typically send the data to your backend API
            alert('Worker saved successfully!');
        }

        function cancelForm() {
            if (confirm('Are you sure you want to cancel? Any unsaved changes will be lost.')) {
                // Clear form or navigate away
                document.getElementById('workerForm').reset();
                alert('Form cancelled');
            }
        }

        function updateStatus() {
            alert('Status update functionality would be implemented here');
        }

        // Tab-specific functions
        function addServiceLine() {
            alert('Add Service Line functionality would be implemented here');
        }

        function setDefaultServiceLine() {
            alert('Set Default Service Line functionality would be implemented here');
        }

        function inactivateServiceLine() {
            alert('Inactivate Service Line functionality would be implemented here');
        }

        function addLocation() {
            alert('Add Location functionality would be implemented here');
        }

        function inactivateLocation() {
            alert('Inactivate Location functionality would be implemented here');
        }

        function addQualification() {
            alert('Add Qualification functionality would be implemented here');
        }

        function editQualification() {
            alert('Edit Qualification functionality would be implemented here');
        }

        function deleteQualification() {
            alert('Delete Qualification functionality would be implemented here');
        }

        function addOrientedClient() {
            alert('Add Oriented Client functionality would be implemented here');
        }

        function addIncompatibleClient() {
            alert('Add Incompatible Client functionality would be implemented here');
        }

        // Phone number formatting
        document.querySelectorAll('input[type="tel"]').forEach(function(input) {
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length >= 6) {
                    value = value.substring(0, 3) + '-' + value.substring(3, 6) + '-' + value.substring(6, 10);
                } else if (value.length >= 3) {
                    value = value.substring(0, 3) + '-' + value.substring(3);
                }
                e.target.value = value;
            });
        });

        // Auto-generate Worker ID placeholder
        document.addEventListener('DOMContentLoaded', function() {
            // In a real application, this would come from the backend
            const workerIdField = document.getElementById('workerId');
            if (!workerIdField.value) {
                workerIdField.placeholder = 'Auto-generated on save';
            }
        });
    </script>
</EditForm>
